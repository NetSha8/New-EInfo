---
import status from "../data/status.json";

interface Props {
    variant?: "pill" | "inline";
    className?: string;
    showNote?: boolean;
}

type StatusConfig = {
    available?: boolean;
    tone?: string;
    label?: string;
    labelOpen?: string;
    labelClosed?: string;
    note?: string;
    noteOpen?: string;
    noteClosed?: string;
};

const { variant = "pill", className = "", showNote = true } = Astro.props;

const config = status as StatusConfig;
const isAvailable = config.available !== false; // default open if not specified
const label =
    config.label ??
    (isAvailable
        ? config.labelOpen ?? "Disponible"
        : config.labelClosed ?? "Non disponible");
const note =
    config.note ??
    (isAvailable
        ? config.noteOpen ?? "Réponse sous 24h"
        : config.noteClosed ?? "Réouverture bientôt");

const toneStyles = {
    open: {
        dot: "bg-emerald-400",
        text: "text-main",
        bg: "bg-emerald-500/10 border border-emerald-500/25",
    },
    busy: {
        dot: "bg-amber-400",
        text: "text-main",
        bg: "bg-amber-500/10 border border-amber-500/25",
    },
    away: {
        dot: "bg-slate-400",
        text: "text-main",
        bg: "bg-slate-500/10 border border-slate-500/20",
    },
    close: {
        dot: "bg-rose-400",
        text: "text-main",
        bg: "bg-rose-500/10 border border-rose-500/25",
    },
} as const;

const toneOverride = config.tone;
const toneKey = (toneOverride && toneOverride in toneStyles
    ? toneOverride
    : isAvailable
        ? "open"
        : "close") as keyof typeof toneStyles;
const palette = toneStyles[toneKey];

const baseClasses =
    variant === "inline"
        ? "inline-flex items-center gap-2 text-sm"
        : "inline-flex items-center gap-2 px-3 py-2 rounded-full text-sm font-medium";

const toneClasses =
    variant === "inline"
        ? `${palette.text}`
        : `${palette.text} ${palette.bg}`;
---

<div class={`${baseClasses} ${toneClasses} ${className}`.trim()}>
    <span class={`w-2 h-2 rounded-full ${palette.dot} animate-pulse`}></span>
    <span>{label}</span>
    {showNote && note && <span class="text-xs text-secondary">· {note}</span>}
</div>
